<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <template id="portal_my_home" inherit_id="portal.portal_my_home">
        <xpath expr="//div[hasclass('o_portal_docs')]" position="inside">
            <!-- <a href="/my/events" class="list-group-item list-group-item-action">
                <span>Events</span>
                <t t-set="placeholder_count" t-value="event_count"/>
            </a> -->
            <t t-call="portal.portal_docs_entry">
                <t t-set="title">Events</t>
                <t t-set="url" t-value="'/my/events'" />
                <t t-set="placeholder_count" t-value="'event_count'" />
            </t>
        </xpath>
    </template>

    <template id="portal_breadcrumbs" inherit_id="portal.portal_breadcrumbs">
        <xpath expr="//ol[hasclass('o_portal_submenu')]" position="inside">
            <li t-if="page_name == 'my_details1'" class="breadcrumb-item">Event Details</li>

            <li t-if="page_name == 'event_form_view'" class="breadcrumb-item active">
                <a t-attf-href="/my/events">Event Details<a>
                        <span> / </span>
                        <t t-esc='event.name' />
                    </a></a>
            </li>

        </xpath>
    </template>


    <template id="event_list_view_portal" name="Events">
        <t t-call="portal.portal_layout">
            <!-- <table> -->
            <t t-call="portal.portal_table">

                <thead>
                    <tr class="active">
                        <th class="text-center">Name</th>
                        <th class="text-center">Start Date</th>
                        <th class="text-center">End Date</th>
                        <th class="text-center">Portal User</th>
                        <th class="text-center">State</th>
                    </tr>
                </thead>
                <tbody>
                    <t t-foreach="events" t-as="event">
                        <tr>
                            <td class="text-center">
                                <a t-att-href="'/my/event/%d' % event.id">
                                    <t t-out="event.name" />
                                </a>

                            </td>
                            <td class="text-center">
                                <t t-out="event.start_date" />
                            </td>
                            <td class="text-center">
                                <t t-out="event.end_date" />
                            </td>
                            <td class="text-center">
                                <t t-out="event.portal_user.name" />
                            </td>
                            <td class="text-center">
                                <span t-if="event.state == 'cancelled'"
                                    class="badge rounded-pill text-bg-secondary">
                                    <i class="fa fa-fw fa-remove" /> Cancelled</span>
                                <span t-if="event.state == 'confirmed'"
                                    class="badge rounded-pill text-bg-secondary">
                                    <i class="fa fa-fw fa-thumbs-up" /> Confirm</span>
                                <span t-if="event.state == 'draft'"
                                    class="badge rounded-pill text-bg-secondary">
                                    <i class="fa fa-fw fa-pencil" /> Draft</span>
                            </td>
                        </tr>
                    </t>
                </tbody>
                <!-- </table> -->
            </t>
        </t>
    </template>

    <!--Form
    view-->
    <!-- Complete page of the sale_order -->
    <template id="event_form_view_portal" inherit_id="portal.portal_sidebar">
        <xpath expr="//div[hasclass('o_portal_sidebar')]" position="inside">
            <t t-if="page_name == 'event_form_view'">
                <div class="row mt16">

                    <t t-call="portal.portal_record_sidebar">
                        <t t-set="classes" t-value="'col-lg-auto d-print-none'" />
                        <t t-set="title">
                            <h2 class="mb-0">
                                <a t-att-href="'/my/event/%d' % event.id">
                                    <b t-field="event.name" />
                                </a>
                            </h2>

                            <td class="text-center">
                                <a
                                    t-att-href="'/web#id=%s&amp;model=%s&amp;view_type=form' % (event.id, event._name)">
                                    <t t-out="event.name" />
                                </a>
                            </td>
                        </t>


                        <t t-set="entries">
                            <ul
                                class="list-group list-group-flush flex-wrap flex-row flex-lg-column">
                                <li class="list-group-item d-grid align-content-start">

                                    <!--button for confirmed-->
                                    <div
                                        t-if="event.state == 'draft' and event.state != 'confirmed' and event.state != 'cancelled'"
                                        class="o_download_pdf btn-toolbar flex-sm-nowrap">
                                        <div class="btn-group flex-grow-1 me-1 mb-1">
                                            <a class="btn btn-secondary o_download_btn"
                                                t-attf-href="/my/event/confirm/#{event.id}"
                                                title="Confirm"><i
                                                    class="fa fa-check o_iban text-success" />
                                                Confirm</a>
                                        </div>
                                    </div>
                                    <!--button for cancel-->
                                    <div
                                        t-if="event.state in ['confirmed']"
                                        class="o_download_pdf btn-toolbar flex-sm-nowrap">
                                        <div class="btn-group flex-grow-1 me-1 mb-1">
                                            <a class="btn btn-secondary o_download_btn"
                                                t-attf-href="/my/event/cancel/#{event.id}"
                                                title="Cancel"><i
                                                    class="fa fa-times o_iban text-danger o_iban_fail" />
                                                Cancel</a>
                                        </div>
                                    </div>
                                    <!--button for draft-->
                                    <div
                                        t-if="event.state != 'draft' and event.state != 'confirmed' and event.state == 'cancelled'"
                                        class="o_download_pdf btn-toolbar flex-sm-nowrap">
                                        <div class="btn-group flex-grow-1 me-1 mb-1">
                                            <a class="btn btn-secondary o_download_btn"
                                                t-attf-href="/my/event/draft/#{event.id}"
                                                title="Draft"><i
                                                    class="fa fa-fw fa-pencil" /> Draft</a>
                                        </div>
                                    </div>

                                    <!--button
                                    for report-->
                                    <div class="btn-toolbar flex-sm-nowrap">
                                        <div class="btn-group flex-grow-1 me-1 mb-1">
                                            <a class="btn btn-primary o_download_report_btn"
                                                t-attf-href="/my/event/print/#{event.id}"
                                                title="Download Report" target="_blank">
                                                <i class="fa fa-file-pdf-o text-danger" /> Download
                                                Report </a>
                                        </div>
                                    </div>

                                </li>

                                <li t-if="event.portal_user" class="list-group-item flex-grow-1">
                                    <div class="small mb-1">
                                        <strong class="text-muted">organizer</strong>
                                    </div>
                                    <div class="row flex-nowrap">
                                        <div class="col flex-grow-0 pe-2">
                                            <img
                                                class="rounded-circle mr4 float-start o_portal_contact_img"
                                                t-att-src="image_data_uri(event.portal_user.avatar_1024)"
                                                alt="Contact" />
                                        </div>
                                        <div class="col ps-0" style="min-width: 150px">
                                            <span t-field="event.portal_user"
                                                t-options='{"widget": "contact", "fields": ["name", "phone"], "no_marker": True}' />
                                            <a href="#discussion" class="small">
                                                <i class="fa fa-comment"></i> Send message </a>
                                        </div>
                                    </div>
                                </li>

                            </ul>
                        </t>
                    </t>

                    <div id="event_content" class="col-12 col-lg justify-content-end">
                        <!-- main content -->
                        <div t-attf-class="card">
                            <div t-call="event_management.event_portal_content" />
                        </div>

                    </div>

                </div>
            </t>
        </xpath>
    </template>

    <template id="event_portal_content" name="Event Portal Content">
        <!-- Informations -->
        <div class="card-body">
            <div class="row">
                <div class="col-3">
                    <h5 class="card-title">Event Start Date :</h5>
                </div>
                <div class="col-3">
                    <p>
                        <t t-esc="event.start_date" t-options="{'widget':'date'}" />
                    </p>
                </div>
            </div>
            <div class="row">
                <div class="col-3">
                    <h5 class="card-title">Event End Date :</h5>
                </div>
                <div class="col-3">
                    <p>
                        <t t-esc="event.end_date" t-options="{'widget':'date'}" />
                    </p>
                </div>
            </div>

            <h5 class="card-title">Event Description :</h5>
            <p t-field="event.description" />

            <h5 class="card-title">Attendees</h5>
            <ul>
                <t t-foreach="event.attendee_ids" t-as="attendee">
                    <li>
                        <span t-esc="attendee.name" />
                    </li>
                </t>
            </ul>
        </div>
    </template>

</odoo>